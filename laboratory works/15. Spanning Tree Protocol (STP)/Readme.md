# Лабораторная работа. Развертывание коммутируемой сети с резервными каналами
**Топология**  
![](1)

**Таблица адресации**  

|Устройство|Интерфейс|IP-адрес|Маска подсети|
|---|---|---|---|
|S1|VLAN 1|192.168.1.1|255.255.255.0|
|S2|VLAN 1|192.168.1.2|255.255.255.0|
|S3|VLAN 1|192.168.1.3|255.255.255.0|
## Цели
### Часть 1. Создание сети и настройка основных параметров устройства
### Часть 2. Выбор корневого моста
### Часть 3. Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов
### Часть 4. Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов  
**Общие сведения/сценарий**  
Избыточность позволяет увеличить доступность устройств в топологии сети за счёт устранения единой точки отказа. Избыточность в коммутируемой сети обеспечивается посредством использования нескольких коммутаторов или нескольких каналов между коммутаторами. Когда в проекте сети используется физическая избыточность, возможно возникновение петель и дублирование кадров.
Протокол spanning-tree (STP) был разработан как механизм предотвращения возникновения петель на 2-м уровне для избыточных каналов коммутируемой сети. Протокол STP обеспечивает наличие только одного логического пути между всеми узлами назначения в сети путем намеренного блокирования резервных путей, которые могли бы вызвать петлю.
В этой лабораторной работе команда show spanning-tree используется для наблюдения за процессом выбора протоколом STP корневого моста. Также буду наблюдать за процессом выбора портов с учетом стоимости и приоритета.  

#### Часть 1:Создание сети и настройка основных параметров устройства
В части 1 я настраиваю топологию сети и основные параметры коммутаторов.  
**Шаг 1:Создаю сеть согласно топологии.**  
Подключаю устройства, как показано в топологии, и подсоединяю необходимые кабели.  
![](2)
**Шаг 2:Выполняю инициализацию и перезагрузку коммутаторов.**  
**Шаг 3:Настраиваю базовые параметры каждого коммутатора.**  
a.Отключаю поиск DNS.  
b.Присваиваю имена устройствам в соответствии с топологией.  
c.Назначаю class в качестве зашифрованного пароля доступа к привилегированному режиму.  
d.Назначаю cisco в качестве паролей консоли и VTY и активируйте вход для консоли и VTY каналов.  
e.Настраиваю logging synchronous для консольного канала.  
f.Настраиваю баннерное сообщение дня (MOTD) для предупреждения пользователей о запрете несанкционированного доступа.  
g.Задаю IP-адрес, указанный в таблице адресации для VLAN 1 на всех коммутаторах.  
h.Сохраняю текущую конфигурацию в файл загрузочной конфигурации.  
**Шаг 4:Проверяю связь.**  
Проверяю способность компьютеров обмениваться эхо-запросами.
![](2)  
![](2)  
![](2)  
#### Часть 2:Определение корневого моста
Для каждого экземпляра протокола spanning-tree (коммутируемая сеть LAN или широковещательный домен) существует коммутатор, выделенный в качестве корневого моста. Корневой мост служит точкой привязки для всех расчётов протокола spanning-tree, позволяя определить избыточные пути, которые следует заблокировать.
Процесс выбора определяет, какой из коммутаторов станет корневым мостом. Коммутатор с наименьшим значением идентификатора моста (BID) становится корневым мостом. Идентификатор BID состоит из значения приоритета моста, расширенного идентификатора системы и MAC-адреса коммутатора. Значение приоритета может находиться в диапазоне от 0 до 65535 с шагом 4096. По умолчанию используется значение 32768.
**Шаг 1:Отключаю все порты на коммутаторах.**  
![](2)
**Шаг 2:	Настраиваю подключенные порты в качестве транковых.**  
![](2)
**Шаг 3:	Включаю порты F0/2 и F0/4 на всех коммутаторах.**  
![](2)
**Шаг 4:	Отображаю данные протокола spanning-tree на всех коммутаторах.**  
![](2)
Приоритет идентификатора моста рассчитывается путем сложения значений приоритета и расширенного идентификатора системы. Расширенным идентификатором системы всегда является номер сети VLAN. В примере ниже все три коммутатора имеют равные значения приоритета идентификатора моста (32769 = 32768 + 1, где приоритет по умолчанию = 32768, номер сети VLAN = 1); следовательно, коммутатор с самым низким значением MAC-адреса становится корневым мостом (в примере — S2).  

В схему ниже записываю роль и состояние (Sts) активных портов на каждом коммутаторе в топологии.  
![](2)
С учетом выходных данных, поступающих с коммутаторов, отвечаю на следующие вопросы.  
Какой коммутатор является корневым мостом? **S1**  
Почему этот коммутатор был выбран протоколом spanning-tree в качестве корневого моста?
**Из за наименьшего значения Mac адреса**  
Какие порты на коммутаторе являются корневыми портами? **S1: -   S2: Fa0/2 S3: Fa0/4**  
Какие порты на коммутаторе являются назначенными портами? **S1:Fa0/2, Fa0/4  S2: -- S3: Fa0/2**  
Какой порт отображается в качестве альтернативного и в настоящее время заблокирован? **S2: Fa0/4**  
Почему протокол spanning-tree выбрал этот порт в качестве невыделенного (заблокированного) порта?
**По BID идентификатору**  
#### Часть 3:Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов
Алгоритм протокола spanning-tree (STA) использует корневой мост как точку привязки, после чего определяет, какие порты будут заблокированы, исходя из стоимости пути. Порт с более низкой стоимостью пути является предпочтительным. Если стоимости портов равны, процесс сравнивает BID. Если BID равны, для определения корневого моста используются приоритеты портов. Наиболее низкие значения являются предпочтительными. В части 3 мне предстоит изменить стоимость порта, чтобы определить, какой порт будет заблокирован протоколом spanning-tree.  
**Шаг 1:Определяю коммутатор с заблокированным портом.**  
При текущей конфигурации только один коммутатор может содержать заблокированный протоколом STP порт. Выполняю команду s`how spanning-tree` на обоих коммутаторах некорневого моста.  
![](2)  
![](2)  
**Шаг 2:Изменяю стоимость порта.**  
Помимо заблокированного порта, единственным активным портом на этом коммутаторе является порт, выделенный в качестве порта корневого моста. Уменьшаю стоимость этого порта корневого моста до 18, выполнив команду spanning-tree cost 18 режима конфигурации интерфейса.  
`S1(config)# interface f0/2`  
`S1(config-if)# spanning-tree cost 18`  
**Шаг 3:Просмотриваю изменения протокола spanning-tree.**  
Повторно выполняю команду `show spanning-tree` на обоих коммутаторах некорневого моста.  
Почему протокол spanning-tree заменяет ранее заблокированный порт на назначенный порт и блокирует порт, который был назначенным портом на другом коммутаторе? **При изминение стоимости порта BID меняется тем самым считая заблокировать порт на другом коммутаторе**  

**Шаг 4:Удаляю изменения стоимости порта.**  
a.	Выполняю команду `no spanning-tree cost 18` в режима конфигурации интерфейса, чтобы удалить запись стоимости, созданную ранее.  
`S1(config)# interface f0/2`  
`S1(config-if)# no spanning-tree cost 18`  
b.	Повторно выполняю команду show spanning-tree, чтобы подтвердить, что протокол STP сбросил порт на коммутаторе некорневого моста, вернув исходные настройки порта.  
#### Часть 4:	Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов
Если стоимости портов равны, процесс сравнивает BID. Если BID равны, для определения корневого моста используются приоритеты портов. Значение приоритета по умолчанию — 128. STP объединяет приоритет порта с номером порта, чтобы разорвать связи. Наиболее низкие значения являются предпочтительными. В части 4 мне предстоит активировать избыточные пути до каждого из коммутаторов, чтобы просмотреть, каким образом протокол STP выбирает порт с учетом приоритета портов.  
a.	Включяю порты F0/1 и F0/3 на всех коммутаторах.  
b.	Жду 30 секунд, чтобы протокол STP завершил процесс перевода порта, после чего выполняю команду `show spanning-tree` на коммутаторах некорневого моста.  
![](2)  
![](2)  
Какой порт выбран протоколом STP в качестве порта корневого моста на каждом коммутаторе некорневого моста?S2: S3:  
Почему протокол STP выбрал эти порты в качестве портов корневого моста на этих коммутаторах?**самое низкое значение BID c портами**  

**Вопросы для повторения**  
1.Какое значение протокол STP использует первым после выбора корневого моста, чтобы определить выбор порта? **Самое низкое значение BID**  
2.Если первое значение на двух портах одинаково, какое следующее значение будет использовать протокол STP при выборе порта?**Если стоимости портов равны, процесс сравнивает BID**  
3.Если оба значения на двух портах равны, каким будет следующее значение, которое использует протокол STP при выборе порта?**Если BID равны, для определения корневого моста используются приоритеты портов.**  

